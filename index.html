<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What a Wonderful World!</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Open+Sans&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
</head>
<body>
  <header>
    <nav class="navbar">
      <h2>ğŸŒ Wonderful World</h2>
      <button id="toggleMode">ğŸŒ</button>
    </nav>
  </header>

  <div class="container">
    <h1>What A Wonderful World</h1>
    <p>Come here to share your wonderful world photos.</p>

    <form id="photoForm">
      <input type="text" id="titleInput" placeholder="Photo Title" required />
      <button id="upload_widget" type="button">Upload Image</button>
      <input type="hidden" id="uploadedImageUrl" />
      <button type="submit">Share Photo</button>
    </form>
  </div>

  <div class="gallery" id="gallery"></div>

  <footer>
    <p>&copy; 2025 What a Wonderful World. Created with â¤ï¸</p>
  </footer>

  <script>
    const form = document.getElementById('photoForm');
    const gallery = document.getElementById('gallery');
    const titleInput = document.getElementById('titleInput');
    const toggleButton = document.getElementById('toggleMode');

    // Generate unique user ID per device
    let userId = localStorage.getItem('userId');
    if (!userId) {
      userId = Date.now().toString() + Math.random().toString(36).substr(2, 5);
      localStorage.setItem('userId', userId);
    }

    let photos = JSON.parse(localStorage.getItem('photos')) || [];

    function renderGallery() {
      gallery.innerHTML = '';
      photos.forEach((photo, index) => {
        const wrapper = document.createElement('div');
        wrapper.classList.add('photo-wrapper');

        const img = document.createElement('img');
        img.src = photo.url;
        img.alt = photo.title;

        const caption = document.createElement('p');
        caption.textContent = photo.title;

        wrapper.appendChild(img);
        wrapper.appendChild(caption);

        if (photo.userId === userId) {
          const btn = document.createElement('button');
          btn.textContent = 'ğŸ—‘ï¸ Delete';
          btn.className = 'delete-button';
          btn.addEventListener('click', () => {
            photos.splice(index, 1);
            localStorage.setItem('photos', JSON.stringify(photos));
            renderGallery();
          });
          wrapper.appendChild(btn);
        }

        gallery.appendChild(wrapper);
      });
    }

    form.addEventListener('submit', function (e) {
      e.preventDefault();

      const imageUrl = document.getElementById('uploadedImageUrl').value;
      if (!imageUrl) {
        alert('Please upload an image first.');
        return;
      }

      const newPhoto = {
        title: titleInput.value,
        url: imageUrl,
        userId: userId
      };

      photos.push(newPhoto);
      localStorage.setItem('photos', JSON.stringify(photos));
      renderGallery();
      form.reset();
      document.getElementById('uploadedImageUrl').value = '';
    });

    const widget = cloudinary.createUploadWidget({
      cloudName: 'duwyexhvj',
      uploadPreset: 'unsigned_preset' // Create this in your Cloudinary dashboard
    }, (error, result) => {
      if (!error && result && result.event === "success") {
        document.getElementById('uploadedImageUrl').value = result.info.secure_url;
        alert("Upload successful!");
      }
    });

    document.getElementById("upload_widget").addEventListener("click", function () {
      widget.open();
    }, false);

    toggleButton.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      toggleButton.textContent = document.body.classList.contains('dark') ? 'ğŸŒ™' : 'ğŸŒ';
    });

    renderGallery();
  </script>
</body>
</html>
